# üìä Firestore Database Schema - E-Voting Platform

This document outlines all the collections, documents, and data structures in your Firestore database for the E-voting project.

## üóÇÔ∏è **Database Collections Overview**

Your E-voting project has **6 main collections** in Firestore:

1. **`users`** - User profiles and verification status
2. **`candidates`** - Election candidates information
3. **`votes`** - Cast votes with verification data
4. **`verificationCodes`** - Temporary verification codes
5. **`idVerifications`** - ID document verification requests
6. **`admins`** - Admin role assignments

---

## üìù **Collection Details**

### 1. üë§ **`users` Collection**

**Purpose**: Store user profiles with comprehensive verification status

**Document ID**: `{userId}` (Firebase Auth UID)

**Schema**:
```typescript
{
  uid: string;                    // Firebase Auth UID
  email: string;                  // User's email address
  phoneNumber?: string;           // Phone number (optional)
  fullName: string;               // Full legal name
  nationalId?: string;            // National ID number (optional)
  dateOfBirth?: string;           // Date of birth (YYYY-MM-DD)
  address?: string;               // Physical address (optional)
  profilePicture?: string;        // Profile picture URL (optional)
  
  // Verification Status
  isEmailVerified: boolean;       // Email verification status
  isPhoneVerified: boolean;       // Phone verification status
  isIdVerified: boolean;          // ID document verification status
  verificationLevel: 'basic' | 'standard' | 'premium';  // Overall verification level
  
  // Voting Status
  votingEligible: boolean;        // Can this user vote?
  hasVoted: boolean;              // Has user already voted?
  voteTimestamp?: Timestamp;      // When they voted (if applicable)
  
  // Timestamps
  registrationDate: Timestamp;    // When account was created
  lastLogin?: Timestamp;          // Last login time
}
```

**Example Document**:
```json
{
  "uid": "user123abc",
  "email": "john.doe@example.com",
  "phoneNumber": "+1234567890",
  "fullName": "John Doe",
  "nationalId": "123456789",
  "dateOfBirth": "1995-05-15",
  "isEmailVerified": true,
  "isPhoneVerified": true,
  "isIdVerified": false,
  "verificationLevel": "standard",
  "votingEligible": true,
  "hasVoted": false,
  "registrationDate": "2024-01-15T10:30:00Z"
}
```

---

### 2. üèõÔ∏è **`candidates` Collection**

**Purpose**: Store information about election candidates

**Document ID**: Auto-generated by Firestore

**Schema**:
```typescript
{
  name: string;                   // Candidate's full name
  party: string;                  // Political party
  description: string;            // Campaign description
  imageUrl?: string;              // Candidate photo URL
  votes: number;                  // Total votes received
  
  // Additional fields (optional)
  position?: string;              // Position running for
  manifesto?: string;             // Campaign promises
  experience?: string;            // Political experience
  createdAt?: Timestamp;          // When candidate was added
}
```

**Example Document**:
```json
{
  "name": "Jane Smith",
  "party": "Democratic Party",
  "description": "Experienced leader focused on education and healthcare reform",
  "imageUrl": "https://example.com/jane-smith.jpg",
  "votes": 1247,
  "position": "Mayor",
  "createdAt": "2024-01-01T00:00:00Z"
}
```

---

### 3. üó≥Ô∏è **`votes` Collection**

**Purpose**: Store all cast votes with verification and audit data

**Document ID**: Auto-generated by Firestore

**Schema**:
```typescript
{
  userId: string;                 // Voter's user ID
  candidateId: string;            // Chosen candidate's ID
  candidateName: string;          // Candidate name (for quick reference)
  timestamp: Timestamp;           // When vote was cast
  verified: boolean;              // Vote verification status
  
  // Enhanced Security Fields
  verificationLevel?: string;     // Voter's verification level
  ipAddress?: string;             // IP address (server-side)
  userAgent?: string;             // Browser user agent
  voteHash?: string;              // Vote hash for integrity
  
  // Audit Trail
  sessionId?: string;             // Voting session ID
  deviceInfo?: string;            // Device information
}
```

**Example Document**:
```json
{
  "userId": "user123abc",
  "candidateId": "candidate456def",
  "candidateName": "Jane Smith",
  "timestamp": "2024-01-15T14:30:00Z",
  "verified": true,
  "verificationLevel": "standard",
  "ipAddress": "192.168.1.100",
  "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64)..."
}
```

---

### 4. üî¢ **`verificationCodes` Collection**

**Purpose**: Store temporary verification codes for phone/email verification

**Document ID**: Auto-generated by Firestore

**Schema**:
```typescript
{
  code: string;                   // 6-digit verification code
  type: 'email' | 'phone' | 'id'; // Verification type
  userId: string;                 // User requesting verification
  expiresAt: Timestamp;           // Code expiration time (10 minutes)
  verified: boolean;              // Has code been used?
  createdAt: Timestamp;           // When code was generated
  
  // Optional fields
  attempts?: number;              // Verification attempts
  phoneNumber?: string;           // Phone number (for phone verification)
}
```

**Example Document**:
```json
{
  "code": "123456",
  "type": "phone",
  "userId": "user123abc",
  "expiresAt": "2024-01-15T10:40:00Z",
  "verified": false,
  "createdAt": "2024-01-15T10:30:00Z",
  "phoneNumber": "+1234567890"
}
```

---

### 5. üìÑ **`idVerifications` Collection**

**Purpose**: Store ID document verification requests for admin review

**Document ID**: Auto-generated by Firestore

**Schema**:
```typescript
{
  userId: string;                             // User submitting verification
  nationalId: string;                         // National ID number
  idType: 'passport' | 'nationalId' | 'drivingLicense'; // ID document type
  documentImageUrl: string;                   // Uploaded document image URL
  status: 'pending' | 'approved' | 'rejected'; // Review status
  submittedAt: Timestamp;                     // Submission time
  
  // Review fields (filled by admin)
  reviewedAt?: Timestamp;                     // Review completion time
  reviewedBy?: string;                        // Admin who reviewed
  rejectionReason?: string;                   // Reason if rejected
  
  // Additional verification data
  ocrData?: object;                           // OCR extracted data
  confidenceScore?: number;                   // AI confidence score
}
```

**Example Document**:
```json
{
  "userId": "user123abc",
  "nationalId": "123456789",
  "idType": "nationalId",
  "documentImageUrl": "https://storage.firebase.com/id-documents/user123abc.jpg",
  "status": "pending",
  "submittedAt": "2024-01-15T09:00:00Z"
}
```

---

### 6. üëë **`admins` Collection**

**Purpose**: Define admin roles and permissions

**Document ID**: `{userId}` (Firebase Auth UID of admin)

**Schema**:
```typescript
{
  userId: string;                 // Admin's user ID
  role: 'superadmin' | 'admin' | 'moderator'; // Admin role level
  permissions: string[];          // Specific permissions array
  assignedBy: string;             // Who granted admin access
  assignedAt: Timestamp;          // When admin role was granted
  active: boolean;                // Is admin role active?
  
  // Optional fields
  department?: string;            // Admin department
  notes?: string;                 // Admin notes
}
```

**Example Document**:
```json
{
  "userId": "admin789xyz",
  "role": "admin",
  "permissions": ["manage_candidates", "review_verifications", "view_results"],
  "assignedBy": "superadmin123",
  "assignedAt": "2024-01-01T00:00:00Z",
  "active": true
}
```

---

## üîê **Security Rules Summary**

Your Firestore security rules ensure:

### **Access Control**:
- **`candidates`**: Read by authenticated users, write by admins only
- **`votes`**: Read by admins only, create by authenticated users, no updates/deletes
- **`users`**: Users can only read/write their own profile
- **`verificationCodes`**: Handled programmatically (no direct access)
- **`idVerifications`**: Handled programmatically (admin review workflow)
- **`admins`**: Read by authenticated users, write by admins only

### **Key Security Features**:
- ‚úÖ **Authentication required** for all operations
- ‚úÖ **Vote integrity** - votes cannot be modified after creation
- ‚úÖ **User isolation** - users can only access their own data
- ‚úÖ **Admin privileges** - special permissions for admin operations
- ‚úÖ **Role-based access** - different access levels based on user role

---

## üìä **Database Statistics**

**Current Collections**: 6
**Total Interfaces**: 6 TypeScript interfaces defined
**Security Rules**: 35+ lines of comprehensive rules
**Verification Levels**: 3 (Basic, Standard, Premium)

---

## üöÄ **Usage Examples**

### **Create User Profile**:
```typescript
await createUserProfile(user, {
  fullName: "John Doe",
  phoneNumber: "+1234567890",
  nationalId: "123456789"
});
```

### **Cast Vote**:
```typescript
await castVote(userId, candidateId, candidateName);
```

### **Check Eligibility**:
```typescript
const eligibility = await checkVotingEligibility(userId);
```

### **Add Candidate**:
```typescript
await addCandidate({
  name: "Jane Smith",
  party: "Democratic Party",
  description: "Experienced leader..."
});
```

---

## üîÑ **Data Flow**

1. **User Registration** ‚Üí Creates document in `users` collection
2. **Email Verification** ‚Üí Updates `isEmailVerified` in `users`
3. **Phone Verification** ‚Üí Creates `verificationCodes` document ‚Üí Updates `users`
4. **ID Verification** ‚Üí Creates `idVerifications` document ‚Üí Admin review
5. **Vote Casting** ‚Üí Creates `votes` document ‚Üí Updates `candidates` votes count
6. **Results** ‚Üí Aggregates data from `votes` and `candidates` collections

---

This comprehensive database schema ensures secure, auditable, and scalable e-voting functionality with complete verification workflows.
